include_directories(${CMAKE_SOURCE_DIR}/src
                    ${CMAKE_CURRENT_SOURCE_DIR}
                    ${EXTERNAL_LIBS}/ffmpeg)

if(WIN32)
    include_directories(${EXTERNAL_LIBS}/pthread-win32/
						${EXTERNAL_LIBS}/libiconv/source/include
                        ${EXTERNAL_LIBS}/win32/)
endif(WIN32)

file(GLOB HEADERS "*.h")                    
file(GLOB SRCS "*.c")

if(WIN32)
	list(APPEND SRCS ${CMAKE_CURRENT_SOURCE_DIR}/../../win32/win32.c)
endif(WIN32)

list(REMOVE_ITEM SRCS ${CMAKE_CURRENT_SOURCE_DIR}/vdpau.c)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/Debug/${MODULE_LIB_DEST_PATH})
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_RELEASE ${CMAKE_RUNTIME_OUTPUT_DIRECTORY}/Release/${MODULE_LIB_DEST_PATH})

add_library(libmltavformat SHARED ${HEADERS} ${SRCS})
target_compile_definitions(libmltavformat PRIVATE -DCODECS -DFILTERS -DAVFILTER -DSWRESAMPLE)
target_link_libraries(libmltavformat libmlt libmlt++ libavformat libavfilter libavutil libswresample libswscale libavcodec)
set_target_properties(libmltavformat PROPERTIES OUTPUT_NAME "libmltavformat")
if(WIN32)
	target_link_libraries(libmltavformat libiconv)
endif(WIN32)